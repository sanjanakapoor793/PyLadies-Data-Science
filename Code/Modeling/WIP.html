<!DOCTYPE html>
<meta charset="utf-8">

<svg width="960" height="600"></svg>
<script src ="d3-queue.js" type="text/javascript"></script>
<!-- <script src ="d3-queue.min.js" type="text/javascript"></script> -->

<script src="https://d3js.org/d3.v5.min.js"></script>

<script>

	var nodes = []
	var links = []

	var topic_to_name = 
		{
			1: "normal language #1", 
			2: "normal lanuage, #2", 
			3: "government/business", 
			4: "enron/stocks", 
			5: "enron -> future risk", 
			6: "legal terms", 
			7: "after work -> relaxation", 
			8: "enron/business/government", 
			9: "technical -> the product", 
			10: "technical regulations", 
			11: "names #1", 
			12: "attachments", 
			13: "months", 
			14: "scheduling meetings", 
			15: "technology related", 
			16: "websites/links", 
			17: "trades", 
			18: "email terms", 
			19: "technical terms", 
			20: "email disclosure policy", 
			21: "travel", 
			22: "fantasy sports", 
			23: "scheduling/random? ", 
			24: "image attachments/random? ", 
			25: "travel/relax/break", 
			26: "fax/email", 
			27: "names #2", 
			28: "names #3", 
			29: "webiste/email technical", 
			30: "relax/after work", 
			31: "names/places", 
			32: "purchases/deals", 
			33: "transactions/business", 
			34: "names #4", 
			35: "trivial nouns", 
			36: "email font formatting", 
			37: "places", 
			38: "scheduling/names", 
			39: "counties/names", 
			40: "bank/funding", 
			41: "failed/unable to perform", 
			42: "scheduling/hours", 
			43: "random #1", 
			44: "numbers", 
			45: "random #2", 
			46: "name/date/formatting", 
			47: "random #3", 
			48: "random #4", 
			49: "random #5", 
			50: "random #6"
		}

	var single_id = '18782981.1075855378110.JavaMail.evans@thyme'


	// d3.json("http://0.0.0.0:5000/similar/" + single_id).then(console.log);
	d3.json("http://0.0.0.0:5000/similar/" + single_id).then(function(data){
		return addNodes(data); 
	});
	// .then(function(data){
	// 	return formatGraphs();
	// });


	function addNodes(list_similar_id){
		/*
		Ok, so right now we have a list of ids. this list of ids corresponds to the ids of the similar documents. 

		Go through the list of similar ids and get all the email information out of them. Then go through and add them to the nodes list after checking that they do not already exist in the list. 

		As we go through the list of similar ids, we break away and go through and add all the topics for which the percentagge/decimal is not zero. again, must check to make sure that the node doesn't already exist. there is no point in adding the same node twice in this new case. 

		*/
		console.log('list_similar_id ' + list_similar_id);

		// nodes.push({id: "Topic 104", subject: "tester topic", topic: 104, status: false});
		list_similar_id.push(single_id);

		const node_queue = d3.queue()
		for (var similar_id of list_similar_id){
			// console.log("starting a fresh one"); 
			console.log(similar_id);
			node_queue.defer(function(cb) {
				d3.json("http://0.0.0.0:5000/EnronEmailData/emails/" + similar_id)
					.then(function(data){
						return manipulateEmails(data); 
					}).then(cb);
			});
		}

		node_queue.awaitAll(function() {
			console.log("nodes added");
			formatGraphs();
		});
	}

	function manipulateEmails(email){
		console.log(email);
		var found = false; 
		for (node of nodes){
			if(node.id === email["_id"])
				found = true; 
		}
		if(!found){
			nodes.push({id: email["_id"], subject: email["subject"], 
				sender: email["sender"], recipient: email["recipient"], status: false});
			return addTopics(email['_id']); 
		}

		return Promise.resolve();

	}

	function addTopics(current_id){
		// console.log(current_id);
		return d3.json("http://0.0.0.0:5000/DocTopicVectors/tVectors/" + current_id).then(function(data){		
					// console.log("data" + data)
			// console.log("current_id " + current_id);
			return manipulateTopics(data); 
		});
	}


	function manipulateTopics(complete_topic_info){
		// console.log(complete_topic_info);
		var complete_topic_values = complete_topic_info['topic_values']; 
		for (single_topic of complete_topic_values){
			// if(single_topic[0] == 1){
			// 	console.log("Topic " + single_topic[0] === "Topic 1");
			// }
			
			var found; 
			if(single_topic[1] != 0){
				found = false; 
				for (var node of nodes){
					if(node.status && node.topic === single_topic[0])
						found = true;
				}
				if(!found){
					// console.log(single_topic);
					topic_dict = {id: "Topic " + single_topic[0], subject: topic_to_name[single_topic[0]], topic: single_topic[0], status: true}
					// console.log(topic_dict);
					nodes.push(topic_dict); 
				}
				var target_label = "Topic " + single_topic[0];
				var source_label = complete_topic_info['_id'];

				// console.log(target_label);
				// console.log(typeof target_label);
				new_obj = {target: target_label, source: source_label, strength: single_topic[1]};
				// console.log(typeof new_obj);
				links.push(new_obj); 
			}
		}
		console.log("manipulate topics test");
		return Promise.resolve();
	}


	// var nodes = [
	// 	{id: "26718848.1075858189959.JavaMail.evans@thyme", subject: "DO you remember theop??", sender: "Mike Carson", recipient: "heather.hill@ac.com", status: false},
	// 	{id: "15258929.1075851767215.JavaMail.evans@thyme", subject: "I thought you would like this site....love you", sender: "Cherry, Beth <Beth.Cherry@enform.com>", recipient: "Jason. Wolfe@enron. com (E-mail) <Jason.Wolfe@enron.com>", status: false},
	// 	{id: "4113869.1075860051346.JavaMail.evans@thyme", subject: "London on the web", sender: "Mark - ECT Legal Taylor", recipient: "tbockius@aol.com", status: false},
	// 	{id: "4922883.1075860920949.JavaMail.evans@thyme", subject: "h: Eyeforenergy Briefing - resend", sender: "Eyeforenergy <bruno@EYEFORENERGY.COM>", recipient: "ENERGYNEWS@FC.EASE.LSOFT.COM", status: false},
	// 	{id: "10643971.1075843999970.JavaMail.evans@thyme", subject: "Re: Monday", sender: "Matt Smith", recipient: "Salazar, Alexis <ASalazar@PIRNIE.COM>", status: false},
	// 	{id: "18782981.1075855378110.JavaMail.evans@thyme", subject: "", sender: "Phillip K Allen", recipient: "Tim Belden <Tim Belden/Enron@EnronXGate>", status: false},
	// 	{id: "Topic 1", subject: "normal language #1", status: true, topic: 1},
	// 	{id: "Topic 2", subject: "normal lanuage, #2", status: true, topic: 2},
	// 	{id: "Topic 3", subject: "government/business", status: true, topic: 3},
	// 	{id: "Topic 4", subject: "enron/stocks", status: true, topic: 4},
	// 	{id: "Topic 5", subject: "enron -> future risk", status: true, topic: 5},
	// 	{id: "Topic 7", subject: "after work -> relaxation", status: true, topic: 7},
	// 	{id: "Topic 9", subject: "technical -> the product", status: true, topic: 9},
	// 	{id: "Topic 10", subject: "technical regulations", status: true, topic: 10},
	// 	{id: "Topic 13", subject: "months", status: true, topic: 13},
	// 	{id: "Topic 14", subject: "scheduling meetings", status: true, topic: 14},
	// 	{id: "Topic 15", subject: "technology related", status: true, topic: 15},
	// 	{id: "Topic 19", subject: "technical terms", status: true, topic: 19},
	// 	{id: "Topic 20", subject: "email disclosure policy", status: true, topic: 20},
	// 	{id: "Topic 21", subject: "travel", status: true, topic: 21},
	// 	{id: "Topic 22", subject: "fantasy sports", status: true, topic: 22},
	// 	{id: "Topic 24", subject: "image attachments/random? ", status: true, topic: 24},
	// 	{id: "Topic 25", subject: "travel/relax/break", status: true, topic: 25},
	// 	{id: "Topic 26", subject: "fax/email", status: true, topic: 26},
	// 	{id: "Topic 27", subject: "names #2", status: true, topic: 27},
	// 	{id: "Topic 28", subject: "names #3", status: true, topic: 28},
	// 	{id: "Topic 30", subject: "relax/after word", status: true, topic: 30},
	// 	{id: "Topic 31", subject: "names/places", status: true, topic: 31},
	// 	{id: "Topic 32", subject: "purchases/deals", status: true, topic: 32},
	// 	{id: "Topic 33", subject: "transactions/business", status: true, topic: 33},
	// 	{id: "Topic 36", subject: "email font formatting", status: true, topic: 36},
	// 	{id: "Topic 37", subject: "places", status: true, topic: 37},
	// 	{id: "Topic 38", subject: "scheduling/names", status: true, topic: 38},
	// 	{id: "Topic 39", subject: "counties/names", status: true, topic: 39},
	// 	{id: "Topic 41", subject: "failed/unable to perform", status: true, topic: 41},
	// 	{id: "Topic 42", subject: "scheduling/hours", status: true, topic: 42},
	// 	{id: "Topic 43", subject: "random #1", status: true, topic: 43},
	// 	{id: "Topic 44", subject: "numbers", status: true, topic: 44},
	// 	{id: "Topic 45", subject: "random #2", status: true, topic: 45},
	// 	{id: "Topic 46", subject: "name/date/formatting", status: true, topic: 46},
	// 	{id: "Topic 48", subject: "random #4", status: true, topic: 48},
	// ]


	// var links = [
	// 	{target: "Topic 1", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.014902436174452305},
	// 	{target: "Topic 2", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.013994281180202961},
	// 	{target: "Topic 3", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.025110527873039246},
	// 	{target: "Topic 4", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.03445781022310257},
	// 	{target: "Topic 5", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.019918303936719894},
	// 	{target: "Topic 7", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.034262750297784805},
	// 	{target: "Topic 9", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.011034884490072727},
	// 	{target: "Topic 10", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02050096169114113},
	// 	{target: "Topic 13", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.05415208265185356},
	// 	{target: "Topic 14", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.012052055448293686},
	// 	{target: "Topic 15", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.010718991979956627},
	// 	{target: "Topic 19", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.03908083215355873},
	// 	{target: "Topic 20", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.01434351410716772},
	// 	{target: "Topic 21", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.014509391970932484},
	// 	{target: "Topic 22", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02672344446182251},
	// 	{target: "Topic 24", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.012949042022228241},
	// 	{target: "Topic 25", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.03619086742401123},
	// 	{target: "Topic 26", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02080748789012432},
	// 	{target: "Topic 27", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.013785628601908684},
	// 	{target: "Topic 28", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.031490907073020935},
	// 	{target: "Topic 30", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.015964830294251442},
	// 	{target: "Topic 31", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02129148691892624},
	// 	{target: "Topic 32", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.11721254885196686},
	// 	{target: "Topic 33", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.01586349681019783},
	// 	{target: "Topic 36", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.022117536514997482},
	// 	{target: "Topic 37", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.04235178604722023},
	// 	{target: "Topic 38", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02951272577047348},
	// 	{target: "Topic 39", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.0172105859965086},
	// 	{target: "Topic 41", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.01687779650092125},
	// 	{target: "Topic 42", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.03092030994594097},
	// 	{target: "Topic 43", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.01627518981695175},
	// 	{target: "Topic 44", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.02043389156460762},
	// 	{target: "Topic 45", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.027165858075022697},
	// 	{target: "Topic 46", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.01673765853047371},
	// 	{target: "Topic 48", source: "26718848.1075858189959.JavaMail.evans@thyme", strength: 0.025684572756290436},
	// 	{target: "Topic 1", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.014902436174452305},
	// 	{target: "Topic 2", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.013994281180202961},
	// 	{target: "Topic 3", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.025110527873039246},
	// 	{target: "Topic 4", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.03445781022310257},
	// 	{target: "Topic 5", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.019918303936719894},
	// 	{target: "Topic 7", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.034262750297784805},
	// 	{target: "Topic 9", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.011034884490072727},
	// 	{target: "Topic 10", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02050096169114113},
	// 	{target: "Topic 13", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.05415208265185356},
	// 	{target: "Topic 14", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.012052055448293686},
	// 	{target: "Topic 15", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.010718991979956627},
	// 	{target: "Topic 19", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.03908083215355873},
	// 	{target: "Topic 20", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.01434351410716772},
	// 	{target: "Topic 21", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.014509391970932484},
	// 	{target: "Topic 22", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02672344446182251},
	// 	{target: "Topic 24", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.012949042022228241},
	// 	{target: "Topic 25", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.03619086742401123},
	// 	{target: "Topic 26", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02080748789012432},
	// 	{target: "Topic 27", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.013785628601908684},
	// 	{target: "Topic 28", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.031490907073020935},
	// 	{target: "Topic 30", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.015964830294251442},
	// 	{target: "Topic 31", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02129148691892624},
	// 	{target: "Topic 32", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.11721254885196686},
	// 	{target: "Topic 33", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.01586349681019783},
	// 	{target: "Topic 36", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.022117536514997482},
	// 	{target: "Topic 37", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.04235178604722023},
	// 	{target: "Topic 38", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02951272577047348},
	// 	{target: "Topic 39", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.0172105859965086},
	// 	{target: "Topic 41", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.01687779650092125},
	// 	{target: "Topic 42", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.03092030994594097},
	// 	{target: "Topic 43", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.01627518981695175},
	// 	{target: "Topic 44", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.02043389156460762},
	// 	{target: "Topic 45", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.027165858075022697},
	// 	{target: "Topic 46", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.01673765853047371},
	// 	{target: "Topic 48", source: "4113869.1075860051346.JavaMail.evans@thyme", strength: 0.025684572756290436},
	// 	{target: "Topic 1", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.014902436174452305},
	// 	{target: "Topic 2", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.013994281180202961},
	// 	{target: "Topic 3", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.025110527873039246},
	// 	{target: "Topic 4", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.03445781022310257},
	// 	{target: "Topic 5", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.019918303936719894},
	// 	{target: "Topic 7", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.034262750297784805},
	// 	{target: "Topic 9", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.011034884490072727},
	// 	{target: "Topic 10", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02050096169114113},
	// 	{target: "Topic 13", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.05415208265185356},
	// 	{target: "Topic 14", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.012052055448293686},
	// 	{target: "Topic 15", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.010718991979956627},
	// 	{target: "Topic 19", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.03908083215355873},
	// 	{target: "Topic 20", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.01434351410716772},
	// 	{target: "Topic 21", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.014509391970932484},
	// 	{target: "Topic 22", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02672344446182251},
	// 	{target: "Topic 24", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.012949042022228241},
	// 	{target: "Topic 25", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.03619086742401123},
	// 	{target: "Topic 26", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02080748789012432},
	// 	{target: "Topic 27", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.013785628601908684},
	// 	{target: "Topic 28", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.031490907073020935},
	// 	{target: "Topic 30", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.015964830294251442},
	// 	{target: "Topic 31", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02129148691892624},
	// 	{target: "Topic 32", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.11721254885196686},
	// 	{target: "Topic 33", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.01586349681019783},
	// 	{target: "Topic 36", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.022117536514997482},
	// 	{target: "Topic 37", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.04235178604722023},
	// 	{target: "Topic 38", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02951272577047348},
	// 	{target: "Topic 39", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.0172105859965086},
	// 	{target: "Topic 41", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.01687779650092125},
	// 	{target: "Topic 42", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.03092030994594097},
	// 	{target: "Topic 43", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.01627518981695175},
	// 	{target: "Topic 44", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.02043389156460762},
	// 	{target: "Topic 45", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.027165858075022697},
	// 	{target: "Topic 46", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.01673765853047371},
	// 	{target: "Topic 48", source: "4922883.1075860920949.JavaMail.evans@thyme", strength: 0.025684572756290436},
	// 	{target: "Topic 1", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.014902436174452305},
	// 	{target: "Topic 2", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.013994281180202961},
	// 	{target: "Topic 3", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.025110527873039246},
	// 	{target: "Topic 4", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.03445781022310257},
	// 	{target: "Topic 5", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.019918303936719894},
	// 	{target: "Topic 7", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.034262750297784805},
	// 	{target: "Topic 9", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.011034884490072727},
	// 	{target: "Topic 10", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02050096169114113},
	// 	{target: "Topic 13", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.05415208265185356},
	// 	{target: "Topic 14", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.012052055448293686},
	// 	{target: "Topic 15", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.010718991979956627},
	// 	{target: "Topic 19", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.03908083215355873},
	// 	{target: "Topic 20", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.01434351410716772},
	// 	{target: "Topic 21", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.014509391970932484},
	// 	{target: "Topic 22", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02672344446182251},
	// 	{target: "Topic 24", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.012949042022228241},
	// 	{target: "Topic 25", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.03619086742401123},
	// 	{target: "Topic 26", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02080748789012432},
	// 	{target: "Topic 27", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.013785628601908684},
	// 	{target: "Topic 28", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.031490907073020935},
	// 	{target: "Topic 30", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.015964830294251442},
	// 	{target: "Topic 31", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02129148691892624},
	// 	{target: "Topic 32", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.11721254885196686},
	// 	{target: "Topic 33", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.01586349681019783},
	// 	{target: "Topic 36", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.022117536514997482},
	// 	{target: "Topic 37", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.04235178604722023},
	// 	{target: "Topic 38", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02951272577047348},
	// 	{target: "Topic 39", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.0172105859965086},
	// 	{target: "Topic 41", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.01687779650092125},
	// 	{target: "Topic 42", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.03092030994594097},
	// 	{target: "Topic 43", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.01627518981695175},
	// 	{target: "Topic 44", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.02043389156460762},
	// 	{target: "Topic 45", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.027165858075022697},
	// 	{target: "Topic 46", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.01673765853047371},
	// 	{target: "Topic 48", source: "10643971.1075843999970.JavaMail.evans@thyme", strength: 0.025684572756290436},
	// 	{target: "Topic 1", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.014902436174452305},
	// 	{target: "Topic 2", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.013994281180202961},
	// 	{target: "Topic 3", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.025110527873039246},
	// 	{target: "Topic 4", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.03445781022310257},
	// 	{target: "Topic 5", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.019918303936719894},
	// 	{target: "Topic 7", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.034262750297784805},
	// 	{target: "Topic 9", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.011034884490072727},
	// 	{target: "Topic 10", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02050096169114113},
	// 	{target: "Topic 13", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.05415208265185356},
	// 	{target: "Topic 14", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.012052055448293686},
	// 	{target: "Topic 15", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.010718991979956627},
	// 	{target: "Topic 19", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.03908083215355873},
	// 	{target: "Topic 20", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.01434351410716772},
	// 	{target: "Topic 21", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.014509391970932484},
	// 	{target: "Topic 22", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02672344446182251},
	// 	{target: "Topic 24", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.012949042022228241},
	// 	{target: "Topic 25", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.03619086742401123},
	// 	{target: "Topic 26", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02080748789012432},
	// 	{target: "Topic 27", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.013785628601908684},
	// 	{target: "Topic 28", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.031490907073020935},
	// 	{target: "Topic 30", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.015964830294251442},
	// 	{target: "Topic 31", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02129148691892624},
	// 	{target: "Topic 32", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.11721254885196686},
	// 	{target: "Topic 33", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.01586349681019783},
	// 	{target: "Topic 36", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.022117536514997482},
	// 	{target: "Topic 37", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.04235178604722023},
	// 	{target: "Topic 38", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02951272577047348},
	// 	{target: "Topic 39", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.0172105859965086},
	// 	{target: "Topic 41", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.01687779650092125},
	// 	{target: "Topic 42", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.03092030994594097},
	// 	{target: "Topic 43", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.01627518981695175},
	// 	{target: "Topic 44", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.02043389156460762},
	// 	{target: "Topic 45", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.027165858075022697},
	// 	{target: "Topic 46", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.01673765853047371},
	// 	{target: "Topic 48", source: "15258929.1075851767215.JavaMail.evans@thyme", strength: 0.025684572756290436},
	// 	{target: "Topic 1", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.013006996363401413},
	// 	{target: "Topic 2", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.012214350514113903},
	// 	{target: "Topic 3", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.021916722878813744},
	// 	{target: "Topic 4", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.03007512353360653},
	// 	{target: "Topic 5", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.01738489605486393},
	// 	{target: "Topic 7", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.02990487404167652},
	// 	{target: "Topic 10", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.01789344660937786},
	// 	{target: "Topic 13", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.04726448282599449},
	// 	{target: "Topic 14", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.01051915530115366},
	// 	{target: "Topic 19", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.03411014750599861},
	// 	{target: "Topic 20", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.012519164010882378},
	// 	{target: "Topic 21", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.012663943693041801},
	// 	{target: "Topic 22", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.023324493318796158},
	// 	{target: "Topic 24", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.011302054859697819},
	// 	{target: "Topic 25", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.03158775717020035},
	// 	{target: "Topic 26", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.0181609857827425},
	// 	{target: "Topic 27", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.012043521739542484},
	// 	{target: "Topic 28", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.027486519888043404},
	// 	{target: "Topic 30", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.013934265822172165},
	// 	{target: "Topic 31", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.018583424389362335},
	// 	{target: "Topic 32", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.10230429470539093},
	// 	{target: "Topic 33", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.013845819979906082},
	// 	{target: "Topic 36", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.019304409623146057},
	// 	{target: "Topic 37", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.03696506470441818},
	// 	{target: "Topic 38", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.025759151205420494},
	// 	{target: "Topic 39", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.015021572820842266},
	// 	{target: "Topic 41", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.014731111004948616},
	// 	{target: "Topic 42", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.026987560093402863},
	// 	{target: "Topic 43", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.014205150306224823},
	// 	{target: "Topic 44", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.14501243829727173},
	// 	{target: "Topic 45", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.02371063455939293},
	// 	{target: "Topic 46", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.014608796685934067},
	// 	{target: "Topic 48", source: "18782981.1075855378110.JavaMail.evans@thyme", strength: 0.02241775393486023}
	// ]

	function formatGraphs(){ 
		// console.log("hello");
		console.log(nodes);
		console.log(links);

		// console.log(nodes[7])
		// var ref_node = {id: "Topic 1", subject: "normal language #1", status: true, topic: 1}; 

		// console.log(nodes[7] === {id: "Topic 1", subject: "normal language #1", status: true, topic: 1});

		var width = window.innerWidth
		var height = window.innerHeight

		var svg = d3.select('svg')
		svg.attr('width', width)
			.attr('height', height)

		var linkForce = d3
			.forceLink()
			.id(function(link) { return link.id})
			.strength(function(link) {return link.strength})

		var simulation = d3
			.forceSimulation()
			.force('link', linkForce)
			.force('charge', d3.forceManyBody().strength(-120))
			.force('center', d3.forceCenter(width/2, height/2))


		// var drag = d3.behavior.drag().on('drag', function(d) {
		// 		var node = d3.select(this), 
		// 			attrs = layout.node(d);
		// 		attrs.x += d3.event.dx;
		// 		attrs.y += d3.event.dy;
		// 		node.attr('transform', 'translate('+ attrs.x + ',' + attrs.y + ')');
		// 	});

		// function dragstart(d, i) {
		// 	simulation.stop()
		// }

		// var drag = d3.drag().on("drag", function () {
  //       	d3.event.sourceEvent.stopPropagation(); // silence other listeners
  //       	dragMove(this, obj, 'points')
  //    	})

		var linkElements = svg.append("g")
			.attr("class", "links")
			.selectAll("line")
			.data(links)
			.enter().append("line")
				.attr("stroke-width", function(link) {return link.strength * 30})
					.attr("stroke", "rgba(200, 0, 0, .2)")

	var node_drag = d3.drag()
        .on("dragstart", drags)
        .on("drag", dragmove)
        .on("dragend", dragend);

    function drags(d, i) {
        simulation.stop() // stops the force auto positioning before you start dragging
    }

    function dragmove(d, i) {
        d.px += d3.event.dx;
        d.py += d3.event.dy;
        d.x += d3.event.dx;
        d.y += d3.event.dy; 
        tick(); // this is the key to make it work together with updating both px,py,x,y on d !
    }

    function dragend(d, i) {
        d.fixed = true; // of course set the node to fixed so the force doesn't include the node in its auto positioning stuff
        tick();
        simulation.resume();
    }
		var nodeElements = svg.append("g")
			.attr("class", "nodes")
			.selectAll("circle")
			.data(nodes)
			.enter().append("circle")
				.attr("r", 10)
			// .call(node_drag)

		

		// nodeElements.call(d3.drag())
		// 	.on("start", dragstarted)
		// 	.on("drag", dragged)
		// 	.on("end", dragended);

		// function dragstarted(d) {
		// 	d.fx = d.x; 
		// 	d.fy = d.y; 
		// }

		// function dragged(d) {
		// 	d.fx = d3.event.x; 
		// 	d.fy = d3.event.y; 
		// }

		// function dragended(d) {
		// 	if(!d3.event.active) {
		// 		d.fx = d3.event.x; 
		// 		d.fy = d3.event.y; 
		// 	}

		// }

		var textElements = svg.append("g")
			.attr("class", "texts")
			.selectAll("text")
			.data(nodes)
			.enter().append("text")
				.text(function(node) {return node.subject})	
					.attr("font-size", 15)
					.attr("dx", 15)
				.attr("dy", 4)

		simulation.nodes(nodes).on('tick', () => {
			nodeElements
				.attr('cx', function(node) {return node.x})
				.attr('cy', function(node) {return node.y})
			textElements
				.attr('x', function(node) {return node.x})
				.attr('y', function(node) {return node.y})
			linkElements
				.attr('x1', function(link) {return link.source.x})
				.attr('y1', function(link) {return link.source.y})
				.attr('x2', function(link) {return link.target.x})
				.attr('y2', function(link) {return link.target.y})
		})

		function tick(){
			linkElements
				.attr('x1', function(link) {return link.source.x})
				.attr('y1', function(link) {return link.source.y})
				.attr('x2', function(link) {return link.target.x})
				.attr('y2', function(link) {return link.target.y})
		}

		simulation.force("link").links(links)
		return null;
	}
	
</script>


